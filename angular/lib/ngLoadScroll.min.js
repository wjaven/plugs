angular.module("ngLoadScroll",[]).factory('listService',['$http','$timeout',function(c,d){var e=function(a){this.itemsName=a.itemsName;this.url=a.url;this.request=a.request;this.items=[];this.busy=false;this.page=1};e.prototype.firstPage=function(){this.items=[];this.page=1;this.nextPage()}e.prototype.nextPage=function(){if(this.busy)return;this.busy=true;c({method:"GET",url:this.url,params:this.request}).success(function(a){var b=a.data[this.itemsName];for(var i=0,len=b.length;i<len;i++){this.items.push(b[i])}this.busy=false;this.page+=1}.bind(this))};return e}]).directive("loadScrollDir",['$rootScope','$window','$timeout',function(i,j,k){return function(b,c,d){var e,elementBottom,busyFlag=false;j=angular.element(j);var f=d.loadScrollDisabled;f=f.substr(0,f.length-5);b.$watch(f,function(a){busyFlag=a.busy;if(b.loadScrollFirstFlag&&!busyFlag){b.loadScrollFirstFlag=false}},true);b.$eval(d.loadScrollFirst);var g=function(){e=j[0].innerHeight+j[0].scrollY;elementBottom=c[0].offsetTop+c[0].offsetHeight-10;if(e>elementBottom){if(busyFlag){return}if(i.$$phase){b.$eval(d.loadScrollDir)}else{b.$apply(d.loadScrollDir)}}};j.on("scroll",g);b.$on('$destroy',function(){j.off('scroll',g)});var h=0,ey=0,my=0;j.on("touchstart",function(a){var t=a.targetTouches||a.originalEvent.targetTouches;h=t[0].pageY});j.on("touchmove",function(a){var t=a.changedTouches||a.originalEvent.changedTouches;ey=t[0].pageY;my=ey-h;if(j[0].scrollY<=0&&my-j[0].scrollY>100){b.loadScrollFirstFlag=true}});j.on("touchend",function(a){if(j[0].scrollY<=0&&my-j[0].scrollY>100){b.$apply(d.loadScrollFirst)}})}}]);
